<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Employee Management</title>
</head>
<body>
<div layout:fragment="page-title">Employee Management</div>

<div layout:fragment="page-actions">
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addEmployeeModal">
        <i class="fas fa-plus"></i> Add Employee
    </button>
</div>

<div layout:fragment="content">
    <!-- Filters -->
    <div class="card mb-4">
        <div class="card-body">
            <form id="filterForm">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label for="departmentFilter" class="form-label">Department</label>
                        <select class="form-select" id="departmentFilter" name="department">
                            <option value="">All Departments</option>
                            <option value="IT">IT</option>
                            <option value="Finance">Finance</option>
                            <option value="HR">HR</option>
                            <option value="Operations">Operations</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="roleFilter" class="form-label">Role</label>
                        <select class="form-select" id="roleFilter" name="role">
                            <option value="">All Roles</option>
                            <option value="Admin">Admin</option>
                            <option value="Manager">Manager</option>
                            <option value="Employee">Employee</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="statusFilter" class="form-label">Status</label>
                        <select class="form-select" id="statusFilter" name="status">
                            <option value="">All Statuses</option>
                            <option value="Active">Active</option>
                            <option value="Inactive">Inactive</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="searchInput" class="form-label">Search</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="searchInput" placeholder="Search employees...">
                            <button class="btn btn-outline-secondary" type="button" id="searchButton">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Employees Table -->
    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">Employees List</h6>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered" id="employeesTable" width="100%" cellspacing="0">
                    <thead>
                    <tr>
                        <th>Avatar</th>
                        <th>Employee ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Department</th>
                        <th>Role</th>
                        <th>Assigned Services</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="employee : ${employees}">
                        <td>
                            <img th:src="${employee.avatar}" alt="Avatar" class="employee-avatar">
                        </td>
                        <td th:text="${employee.id}">EMP-001</td>
                        <td th:text="${employee.name}">John Doe</td>
                        <td th:text="${employee.email}">john.doe@example.com</td>
                        <td th:text="${employee.department}">IT</td>
                        <td>
                            <span class="badge bg-primary" th:if="${employee.role == 'Admin'}">Admin</span>
                            <span class="badge bg-info" th:if="${employee.role == 'Manager'}">Manager</span>
                            <span class="badge bg-secondary" th:if="${employee.role == 'Employee'}">Employee</span>
                        </td>
                        <td th:text="${employee.assignedServicesCount}">5</td>
                        <td>
                            <span class="badge bg-success" th:if="${employee.status == 'Active'}">Active</span>
                            <span class="badge bg-secondary" th:if="${employee.status == 'Inactive'}">Inactive</span>
                        </td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-info view-employee" data-bs-toggle="modal" data-bs-target="#viewEmployeeModal" th:data-id="${employee.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-primary edit-employee" data-bs-toggle="modal" data-bs-target="#addEmployeeModal" th:data-id="${employee.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger delete-employee" th:data-id="${employee.id}" th:if="${#authentication.name == 'admin'}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add/Edit Employee Modal -->
    <div class="modal fade" id="addEmployeeModal" tabindex="-1" aria-labelledby="addEmployeeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addEmployeeModalLabel">Add New Employee</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="employeeForm" th:action="@{/employees/save}" th:object="${employee}" method="post">
                        <input type="hidden" id="employeeId" th:field="*{id}">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="firstName" class="form-label">First Name</label>
                                <input type="text" class="form-control" id="firstName" th:field="*{firstName}" required>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('firstName')}" th:errors="*{firstName}">First Name is required</div>
                            </div>
                            <div class="col-md-6">
                                <label for="lastName" class="form-label">Last Name</label>
                                <input type="text" class="form-control" id="lastName" th:field="*{lastName}" required>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('lastName')}" th:errors="*{lastName}">Last Name is required</div>
                            </div>
                            <div class="col-md-6">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" th:field="*{email}" required>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('email')}" th:errors="*{email}">Valid email is required</div>
                            </div>
                            <div class="col-md-6">
                                <label for="phone" class="form-label">Phone</label>
                                <input type="tel" class="form-control" id="phone" th:field="*{phone}">
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('phone')}" th:errors="*{phone}">Valid phone number is required</div>
                            </div>
                            <div class="col-md-6">
                                <label for="department" class="form-label">Department</label>
                                <select class="form-select" id="department" th:field="*{department}" required>
                                    <option value="">Select Department</option>
                                    <option value="IT">IT</option>
                                    <option value="Finance">Finance</option>
                                    <option value="HR">HR</option>
                                    <option value="Operations">Operations</option>
                                </select>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('department')}" th:errors="*{department}">Department is required</div>
                            </div>
                            <div class="col-md-6">
                                <label for="role" class="form-label">Role</label>
                                <select class="form-select" id="role" th:field="*{role}" required>
                                    <option value="">Select Role</option>
                                    <option value="Admin">Admin</option>
                                    <option value="Manager">Manager</option>
                                    <option value="Employee">Employee</option>
                                </select>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('role')}" th:errors="*{role}">Role is required</div>
                            </div>
                            <div class="col-md-6">
                                <label for="status" class="form-label">Status</label>
                                <select class="form-select" id="status" th:field="*{status}" required>
                                    <option value="Active">Active</option>
                                    <option value="Inactive">Inactive</option>
                                </select>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('status')}" th:errors="*{status}">Status is required</div>
                            </div>
                            <div class="col-md-6">
                                <label for="hireDate" class="form-label">Hire Date</label>
                                <input type="date" class="form-control" id="hireDate" th:field="*{hireDate}" required>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('hireDate')}" th:errors="*{hireDate}">Hire Date is required</div>
                            </div>
                            <div class="col-12">
                                <label for="address" class="form-label">Address</label>
                                <input type="text" class="form-control" id="address" th:field="*{address}">
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('address')}" th:errors="*{address}">Address is required</div>
                            </div>
                            <div class="col-12">
                                <label for="notes" class="form-label">Notes</label>
                                <textarea class="form-control" id="notes" th:field="*{notes}" rows="3"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveEmployee">Save Employee</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Employee Modal -->
    <div class="modal fade" id="viewEmployeeModal" tabindex="-1" aria-labelledby="viewEmployeeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewEmployeeModalLabel">Employee Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-4 text-center">
                            <img id="viewEmployeeAvatar" src="https://via.placeholder.com/150" alt="Avatar" class="img-thumbnail mb-3">
                            <h5 id="viewEmployeeName">John Doe</h5>
                            <p id="viewEmployeeRole" class="text-muted">IT Manager</p>
                        </div>
                        <div class="col-md-8">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Employee ID:</strong> <span id="viewEmployeeId">EMP-001</span></p>
                                    <p><strong>Email:</strong> <span id="viewEmployeeEmail">john.doe@example.com</span></p>
                                    <p><strong>Phone:</strong> <span id="viewEmployeePhone">+1 (555) 123-4567</span></p>
                                    <p><strong>Department:</strong> <span id="viewEmployeeDepartment">IT</span></p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Status:</strong> <span id="viewEmployeeStatus"><span class="badge bg-success">Active</span></span></p>
                                    <p><strong>Hire Date:</strong> <span id="viewEmployeeHireDate">2020-01-15</span></p>
                                    <p><strong>Address:</strong> <span id="viewEmployeeAddress">123 Main St, City, Country</span></p>
                                </div>
                            </div>
                            <div class="mt-3">
                                <p><strong>Notes:</strong></p>
                                <p id="viewEmployeeNotes">Experienced IT professional with expertise in network management.</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h6 class="m-0 font-weight-bold text-primary">Assigned Services</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                    <tr>
                                        <th>Service ID</th>
                                        <th>Provider</th>
                                        <th>Account Number</th>
                                        <th>Monthly Fee</th>
                                        <th>Status</th>
                                    </tr>
                                    </thead>
                                    <tbody id="assignedServices">
                                    <tr>
                                        <td>SRV-001</td>
                                        <td>STC</td>
                                        <td>ACC-12345</td>
                                        <td>$25.00</td>
                                        <td><span class="badge bg-success">Active</span></td>
                                    </tr>
                                    <tr>
                                        <td>SRV-005</td>
                                        <td>Mobily</td>
                                        <td>ACC-54321</td>
                                        <td>$30.00</td>
                                        <td><span class="badge bg-success">Active</span></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary edit-from-view" data-bs-toggle="modal" data-bs-target="#addEmployeeModal">Edit</button>
                </div>
            </div>
        </div>
    </div>
</div>

<th:block layout:fragment="scripts">
    <script>
        $(document).ready(function() {
            // Initialize DataTable
            const employeesTable = $('#employeesTable').DataTable({
                responsive: true,
                pageLength: 10,
                dom: '<"row"<"col-sm-6"l><"col-sm-6"f>>rtip'
            });

            // Filter functionality
            $('#departmentFilter, #roleFilter, #statusFilter').on('change', function() {
                employeesTable.draw();
            });

            $('#searchButton').on('click', function() {
                employeesTable.search($('#searchInput').val()).draw();
            });

            $('#searchInput').on('keyup', function(e) {
                if (e.key === 'Enter') {
                    employeesTable.search($(this).val()).draw();
                }
            });

            // View Employee
            $('.view-employee').on('click', function() {
                const employeeId = $(this).data('id');
                // In a real application, you would fetch the employee details via AJAX
                // For this example, we'll just show the modal
                $('#viewEmployeeModal').modal('show');
            });

            // Edit Employee
            $('.edit-employee').on('click', function() {
                const employeeId = $(this).data('id');
                // In a real application, you would fetch the employee details via AJAX
                // For this example, we'll just show the modal
                $('#addEmployeeModalLabel').text('Edit Employee');
                $('#employeeId').val(employeeId);
                $('#addEmployeeModal').modal('show');
            });

            // Delete Employee
            $('.delete-employee').on('click', function() {
                const employeeId = $(this).data('id');
                if (confirm('Are you sure you want to delete this employee?')) {
                    // In a real application, you would send an AJAX request to delete the employee
                    // For this example, we'll just remove the row from the table
                    $(this).closest('tr').remove();
                    // Show success message
                    const alert = $('<div class="alert alert-success alert-dismissible fade show" role="alert">Employee deleted successfully.<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>');
                    $('.content').prepend(alert);
                    setTimeout(function() {
                        alert.alert('close');
                    }, 3000);
                }
            });

            // Reset form when modal is closed
            $('#addEmployeeModal').on('hidden.bs.modal', function() {
                $('#employeeForm')[0].reset();
                $('#addEmployeeModalLabel').text('Add New Employee');
                $('#employeeId').val('');
            });

            // Save Employee
            $('#saveEmployee').on('click', function() {
                // In a real application, you would submit the form via AJAX
                // For this example, we'll just validate and show a success message
                if ($('#employeeForm')[0].checkValidity()) {
                    $('#addEmployeeModal').modal('hide');
                    const alert = $('<div class="alert alert-success alert-dismissible fade show" role="alert">Employee saved successfully.<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>');
                    $('.content').prepend(alert);
                    setTimeout(function() {
                        alert.alert('close');
                    }, 3000);
                } else {
                    $('#employeeForm')[0].reportValidity();
                }
            });

            // Edit from View button
            $('.edit-from-view').on('click', function() {
                $('#viewEmployeeModal').modal('hide');
            });
        });
    </script>
</th:block>
</body>
</html>